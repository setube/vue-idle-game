!function(){"use strict";let e=null,t=null;self.onmessage=e=>{const{type:t,data:s}=e.data;switch(t){case"START_TASK":a(s);break;case"CANCEL_TASK":r();break;default:console.error("未知的消息类型:",t)}};const a=a=>{e&&r(),e={id:a.taskId,duration:a.duration,startTime:Date.now(),progress:0};const l=Math.max(50,Math.floor(a.duration/100));t=setInterval((()=>{s()}),l)},s=()=>{if(!e)return;const a=Date.now()-e.startTime,s=Math.min(100,Math.floor(a/e.duration*100));e.progress=s,self.postMessage({type:"TASK_PROGRESS",data:{taskId:e.id,progress:s}}),s>=100&&(clearInterval(t),t=null,e=null)},r=()=>{t&&(clearInterval(t),t=null),e=null,self.postMessage({type:"TASK_CANCELLED"})};self.addEventListener("beforeunload",(()=>{t&&clearInterval(t)}))}();
